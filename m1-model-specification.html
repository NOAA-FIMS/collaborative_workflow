<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 M1 model specification | FIMS Developer Handbook</title>
  <meta name="description" content="This is a handbook for FIMS developers and contributors." />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 M1 model specification | FIMS Developer Handbook" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a handbook for FIMS developers and contributors." />
  <meta name="github-repo" content="noaa-fims/collaborative_workflow" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 M1 model specification | FIMS Developer Handbook" />
  
  <meta name="twitter:description" content="This is a handbook for FIMS developers and contributors." />
  

<meta name="author" content="FIMS Implementation Team" />


<meta name="date" content="2025-03-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon/favicon.ico" type="image/x-icon" />
<link rel="prev" href="fims-project-management-process.html"/>
<link rel="next" href="user-guide.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/d3-3.3.8/d3.min.js"></script>
<script src="libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/chromatography-0.1/chromatography.js"></script>
<script src="libs/DiagrammeR-binding-1.0.11/DiagrammeR.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="extra.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FIMS Developer Guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Contributing to this book</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#description"><i class="fa fa-check"></i><b>1.1</b> Description</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#edit-and-preview-book-changes"><i class="fa fa-check"></i><b>1.2</b> Edit and preview book changes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="code-of-conduct.html"><a href="code-of-conduct.html"><i class="fa fa-check"></i><b>2</b> Code of conduct</a>
<ul>
<li class="chapter" data-level="2.1" data-path="code-of-conduct.html"><a href="code-of-conduct.html#fims-contributor-conduct"><i class="fa fa-check"></i><b>2.1</b> FIMS contributor conduct</a></li>
<li class="chapter" data-level="2.2" data-path="code-of-conduct.html"><a href="code-of-conduct.html#our-pledge"><i class="fa fa-check"></i><b>2.2</b> Our pledge</a></li>
<li class="chapter" data-level="2.3" data-path="code-of-conduct.html"><a href="code-of-conduct.html#our-standards"><i class="fa fa-check"></i><b>2.3</b> Our standards</a></li>
<li class="chapter" data-level="2.4" data-path="code-of-conduct.html"><a href="code-of-conduct.html#enforcement-responsibilities"><i class="fa fa-check"></i><b>2.4</b> Enforcement responsibilities</a></li>
<li class="chapter" data-level="2.5" data-path="code-of-conduct.html"><a href="code-of-conduct.html#scope"><i class="fa fa-check"></i><b>2.5</b> Scope</a></li>
<li class="chapter" data-level="2.6" data-path="code-of-conduct.html"><a href="code-of-conduct.html#enforcement"><i class="fa fa-check"></i><b>2.6</b> Enforcement</a></li>
<li class="chapter" data-level="2.7" data-path="code-of-conduct.html"><a href="code-of-conduct.html#enforcement-guidelines"><i class="fa fa-check"></i><b>2.7</b> Enforcement guidelines</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="code-of-conduct.html"><a href="code-of-conduct.html#correction"><i class="fa fa-check"></i><b>2.7.1</b> 1. Correction</a></li>
<li class="chapter" data-level="2.7.2" data-path="code-of-conduct.html"><a href="code-of-conduct.html#warning"><i class="fa fa-check"></i><b>2.7.2</b> 2. Warning</a></li>
<li class="chapter" data-level="2.7.3" data-path="code-of-conduct.html"><a href="code-of-conduct.html#temporary-ban"><i class="fa fa-check"></i><b>2.7.3</b> 3. Temporary ban</a></li>
<li class="chapter" data-level="2.7.4" data-path="code-of-conduct.html"><a href="code-of-conduct.html#permanent-ban"><i class="fa fa-check"></i><b>2.7.4</b> 4. Permanent ban</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="code-of-conduct.html"><a href="code-of-conduct.html#supporting-good-conduct"><i class="fa fa-check"></i><b>2.8</b> Supporting good conduct</a></li>
<li class="chapter" data-level="2.9" data-path="code-of-conduct.html"><a href="code-of-conduct.html#attribution"><i class="fa fa-check"></i><b>2.9</b> Attribution</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html"><i class="fa fa-check"></i><b>3</b> FIMS project management process</a>
<ul>
<li class="chapter" data-level="3.1" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#fims-governance"><i class="fa fa-check"></i><b>3.1</b> FIMS governance</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#developers"><i class="fa fa-check"></i><b>3.1.1</b> Developers</a></li>
<li class="chapter" data-level="3.1.2" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#c-developers"><i class="fa fa-check"></i><b>3.1.2</b> C++ developers</a></li>
<li class="chapter" data-level="3.1.3" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#r-developers"><i class="fa fa-check"></i><b>3.1.3</b> R developers</a></li>
<li class="chapter" data-level="3.1.4" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#all-developers"><i class="fa fa-check"></i><b>3.1.4</b> All developers</a></li>
<li class="chapter" data-level="3.1.5" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#project-lead"><i class="fa fa-check"></i><b>3.1.5</b> Project Lead</a></li>
<li class="chapter" data-level="3.1.6" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#lead-software-architect"><i class="fa fa-check"></i><b>3.1.6</b> Lead Software Architect</a></li>
<li class="chapter" data-level="3.1.7" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#lead-test-engineer"><i class="fa fa-check"></i><b>3.1.7</b> Lead Test Engineer</a></li>
<li class="chapter" data-level="3.1.8" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#lead-statistical-computing-engineer"><i class="fa fa-check"></i><b>3.1.8</b> Lead Statistical Computing Engineer</a></li>
<li class="chapter" data-level="3.1.9" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#outreach-and-transition-coordinator"><i class="fa fa-check"></i><b>3.1.9</b> Outreach and Transition Coordinator</a></li>
<li class="chapter" data-level="3.1.10" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#lead-of-workflows-accessibility-and-integration"><i class="fa fa-check"></i><b>3.1.10</b> Lead of Workflows, Accessibility, and Integration</a></li>
<li class="chapter" data-level="3.1.11" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#regional-representatives"><i class="fa fa-check"></i><b>3.1.11</b> Regional representatives</a></li>
<li class="chapter" data-level="3.1.12" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#code-of-conduct-enforcement"><i class="fa fa-check"></i><b>3.1.12</b> Code of conduct enforcement</a></li>
<li class="chapter" data-level="3.1.13" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#external-collaborators"><i class="fa fa-check"></i><b>3.1.13</b> External collaborators</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#fims-development-cycle"><i class="fa fa-check"></i><b>3.2</b> FIMS development cycle</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#issue-lifecycle"><i class="fa fa-check"></i><b>3.2.1</b> Issue lifecycle</a></li>
<li class="chapter" data-level="3.2.2" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#m2-development-workflow"><i class="fa fa-check"></i><b>3.2.2</b> M2 development workflow</a></li>
<li class="chapter" data-level="3.2.3" data-path="fims-project-management-process.html"><a href="fims-project-management-process.html#feature-validation"><i class="fa fa-check"></i><b>3.2.3</b> Feature validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="m1-model-specification.html"><a href="m1-model-specification.html"><i class="fa fa-check"></i><b>4</b> M1 model specification</a>
<ul>
<li class="chapter" data-level="4.1" data-path="m1-model-specification.html"><a href="m1-model-specification.html#inherited-functors-from-tmb"><i class="fa fa-check"></i><b>4.1</b> Inherited functors from <code>TMB</code></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="m1-model-specification.html"><a href="m1-model-specification.html#atomic-functions"><i class="fa fa-check"></i><b>4.1.1</b> Atomic functions</a></li>
<li class="chapter" data-level="4.1.2" data-path="m1-model-specification.html"><a href="m1-model-specification.html#statistical-distributions"><i class="fa fa-check"></i><b>4.1.2</b> Statistical distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="m1-model-specification.html"><a href="m1-model-specification.html#beverton-holt-recruitment-function"><i class="fa fa-check"></i><b>4.2</b> Beverton-Holt recruitment function</a></li>
<li class="chapter" data-level="4.3" data-path="m1-model-specification.html"><a href="m1-model-specification.html#logistic-function-with-extensions"><i class="fa fa-check"></i><b>4.3</b> Logistic function with extensions</a></li>
<li class="chapter" data-level="4.4" data-path="m1-model-specification.html"><a href="m1-model-specification.html#catch-and-fishing-mortality"><i class="fa fa-check"></i><b>4.4</b> Catch and fishing mortality</a></li>
<li class="chapter" data-level="4.5" data-path="m1-model-specification.html"><a href="m1-model-specification.html#modeling-loops"><i class="fa fa-check"></i><b>4.5</b> Modeling loops</a></li>
<li class="chapter" data-level="4.6" data-path="m1-model-specification.html"><a href="m1-model-specification.html#expected-numbers-and-quantities"><i class="fa fa-check"></i><b>4.6</b> Expected numbers and quantities</a></li>
<li class="chapter" data-level="4.7" data-path="m1-model-specification.html"><a href="m1-model-specification.html#initial-values"><i class="fa fa-check"></i><b>4.7</b> Initial values</a></li>
<li class="chapter" data-level="4.8" data-path="m1-model-specification.html"><a href="m1-model-specification.html#likelihood-calculations"><i class="fa fa-check"></i><b>4.8</b> Likelihood calculations</a></li>
<li class="chapter" data-level="4.9" data-path="m1-model-specification.html"><a href="m1-model-specification.html#statistical-inference"><i class="fa fa-check"></i><b>4.9</b> Statistical Inference:</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="user-guide.html"><a href="user-guide.html"><i class="fa fa-check"></i><b>5</b> User guide</a>
<ul>
<li class="chapter" data-level="5.1" data-path="user-guide.html"><a href="user-guide.html#installing-the-package-from-r-universe"><i class="fa fa-check"></i><b>5.1</b> Installing the package from R universe</a></li>
<li class="chapter" data-level="5.2" data-path="user-guide.html"><a href="user-guide.html#running-fims"><i class="fa fa-check"></i><b>5.2</b> Running FIMS</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html"><i class="fa fa-check"></i><b>6</b> Developer Software and Installation Guide</a>
<ul>
<li class="chapter" data-level="6.1" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#codespaces-as-an-alternative-to-installing-software"><i class="fa fa-check"></i><b>6.1</b> Codespaces as an alternative to installing software</a></li>
<li class="chapter" data-level="6.2" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#software-to-install"><i class="fa fa-check"></i><b>6.2</b> Software to install</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#git"><i class="fa fa-check"></i><b>6.2.1</b> git</a></li>
<li class="chapter" data-level="6.2.2" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#development-environment"><i class="fa fa-check"></i><b>6.2.2</b> Development environment</a></li>
<li class="chapter" data-level="6.2.3" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#c-compiler"><i class="fa fa-check"></i><b>6.2.3</b> C++ compiler</a></li>
<li class="chapter" data-level="6.2.4" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#googletest"><i class="fa fa-check"></i><b>6.2.4</b> GoogleTest</a></li>
<li class="chapter" data-level="6.2.5" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#gdb-debugger"><i class="fa fa-check"></i><b>6.2.5</b> GDB debugger</a></li>
<li class="chapter" data-level="6.2.6" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#doxygen"><i class="fa fa-check"></i><b>6.2.6</b> Doxygen</a></li>
<li class="chapter" data-level="6.2.7" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#r"><i class="fa fa-check"></i><b>6.2.7</b> R</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#installing-fims"><i class="fa fa-check"></i><b>6.3</b> Installing FIMS</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#clone-and-build"><i class="fa fa-check"></i><b>6.3.1</b> Clone and build</a></li>
<li class="chapter" data-level="6.3.2" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#precompiled"><i class="fa fa-check"></i><b>6.3.2</b> Precompiled</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="developer-software-and-installation-guide.html"><a href="developer-software-and-installation-guide.html#getting-help"><i class="fa fa-check"></i><b>6.4</b> Getting Help</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html"><i class="fa fa-check"></i><b>7</b> Contributor Guidelines</a>
<ul>
<li class="chapter" data-level="7.1" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#code"><i class="fa fa-check"></i><b>7.1</b> Code</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#style-guide"><i class="fa fa-check"></i><b>7.1.1</b> Style Guide</a></li>
<li class="chapter" data-level="7.1.2" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#coding-good-practices"><i class="fa fa-check"></i><b>7.1.2</b> Coding Good Practices</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#github-collaborative-environment"><i class="fa fa-check"></i><b>7.2</b> GitHub Collaborative Environment</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#github-issues"><i class="fa fa-check"></i><b>7.2.1</b> GitHub Issues</a></li>
<li class="chapter" data-level="7.2.2" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#github-cloning"><i class="fa fa-check"></i><b>7.2.2</b> GitHub Cloning</a></li>
<li class="chapter" data-level="7.2.3" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#github-branching"><i class="fa fa-check"></i><b>7.2.3</b> GitHub Branching</a></li>
<li class="chapter" data-level="7.2.4" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#github-pull-requests"><i class="fa fa-check"></i><b>7.2.4</b> GitHub Pull Requests</a></li>
<li class="chapter" data-level="7.2.5" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#github-actions"><i class="fa fa-check"></i><b>7.2.5</b> GitHub Actions</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#git-1"><i class="fa fa-check"></i><b>7.3</b> git</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="contributor-guidelines.html"><a href="contributor-guidelines.html#git-example"><i class="fa fa-check"></i><b>7.3.1</b> git Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="hpp-template-for-c-modules.html"><a href="hpp-template-for-c-modules.html"><i class="fa fa-check"></i><b>8</b> .hpp template for C++ modules</a></li>
<li class="chapter" data-level="9" data-path="documentation-template.html"><a href="documentation-template.html"><i class="fa fa-check"></i><b>9</b> Documentation Template</a>
<ul>
<li class="chapter" data-level="9.1" data-path="documentation-template.html"><a href="documentation-template.html#writing-function-reference"><i class="fa fa-check"></i><b>9.1</b> Writing function reference</a></li>
<li class="chapter" data-level="9.2" data-path="documentation-template.html"><a href="documentation-template.html#writing-a-vignette"><i class="fa fa-check"></i><b>9.2</b> Writing a vignette</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>10</b> Testing</a>
<ul>
<li class="chapter" data-level="10.1" data-path="testing.html"><a href="testing.html#introduction"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="testing.html"><a href="testing.html#c-unit-testing-and-benchmarking"><i class="fa fa-check"></i><b>10.2</b> C++ unit testing and benchmarking</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="testing.html"><a href="testing.html#build-and-run-the-tests"><i class="fa fa-check"></i><b>10.2.1</b> Build and run the tests</a></li>
<li class="chapter" data-level="10.2.2" data-path="testing.html"><a href="testing.html#adding-a-c-test"><i class="fa fa-check"></i><b>10.2.2</b> Adding a C++ test</a></li>
<li class="chapter" data-level="10.2.3" data-path="testing.html"><a href="testing.html#debugging-a-c-test"><i class="fa fa-check"></i><b>10.2.3</b> Debugging a C++ test</a></li>
<li class="chapter" data-level="10.2.4" data-path="testing.html"><a href="testing.html#benchmark-example"><i class="fa fa-check"></i><b>10.2.4</b> Benchmark example</a></li>
<li class="chapter" data-level="10.2.5" data-path="testing.html"><a href="testing.html#clean-up-after-running-c-tests"><i class="fa fa-check"></i><b>10.2.5</b> Clean up after running C++ tests</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="testing.html"><a href="testing.html#templates-for-googletest-testing"><i class="fa fa-check"></i><b>10.3</b> Templates for GoogleTest testing</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="testing.html"><a href="testing.html#c-test-templates"><i class="fa fa-check"></i><b>10.3.1</b> C++ test templates</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="testing.html"><a href="testing.html#r-testing"><i class="fa fa-check"></i><b>10.4</b> R testing</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="testing.html"><a href="testing.html#testing-fims-locally"><i class="fa fa-check"></i><b>10.4.1</b> Testing FIMS locally</a></li>
<li class="chapter" data-level="10.4.2" data-path="testing.html"><a href="testing.html#testing-using-gdbsource"><i class="fa fa-check"></i><b>10.4.2</b> Testing using <code>gdbsource</code></a></li>
<li class="chapter" data-level="10.4.3" data-path="testing.html"><a href="testing.html#and-file-organization"><i class="fa fa-check"></i><b>10.4.3</b> and file organization</a></li>
<li class="chapter" data-level="10.4.4" data-path="testing.html"><a href="testing.html#r-template"><i class="fa fa-check"></i><b>10.4.4</b> R template</a></li>
<li class="chapter" data-level="10.4.5" data-path="testing.html"><a href="testing.html#random-numbers"><i class="fa fa-check"></i><b>10.4.5</b> Random numbers</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://noaa-fims.github.io/collaborative_workflow" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">FIMS Developer Handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="m1-model-specification" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> M1 model specification<a href="m1-model-specification.html#m1-model-specification" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section describes the implementation of the modules in FIMS in
milestone 1. For the first milestone, we implemented enough
complexity to adequately test a very standard population model. For this
reason, we implemented the minimum structure that can run the model
described in <a href="https://spo.nmfs.noaa.gov/content/fishery-bulletin/comparison-4-primary-age-structured-stock-assessment-models-used-united">Li et al. 2021</a>.
The FIMS at the end of milestone 1 is an age-structured
integrated assessment model with two fleets (one survey, one fishery)
and two sexes.</p>
<div id="inherited-functors-from-tmb" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Inherited functors from <code>TMB</code><a href="m1-model-specification.html#inherited-functors-from-tmb" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="atomic-functions" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Atomic functions<a href="m1-model-specification.html#atomic-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Wherever possible, <code>FIMS</code> avoids reinventing atomic functions with
extant definitions in <code>TMB</code>. If there is a need for a new atomic
function the development team can add it to <code>TMB</code> using the
<code>TMB_ATOMIC_VECTOR_FUNCTION()</code> macro following the instructions
<a href="https://kaskr.github.io/adcomp/_book/AtomicFunctions.html#example-adding-new-primitive-function-with-known-derivatives">here</a>.
Prototype atomic functions under development for future FIMS milestones are stored in the <a href="https://github.com/NOAA-FIMS/m1-prototypes/blob/main/fims_math.hpp">fims_math.hpp</a> file in the <a href="https://github.com/NOAA-FIMS/m1-prototypes">m1-prototypes</a> repository.</p>
</div>
<div id="statistical-distributions" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Statistical distributions<a href="m1-model-specification.html#statistical-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>All of the statistical distributions needed for the first milestone of
<code>FIMS</code> are implemented in <code>TMB</code> and need not be replicated.
Code can be found <a href="http://kaskr.github.io/adcomp/group__R__style__distribution.html">here</a>.</p>
<table>
<colgroup>
<col width="38%" />
<col width="29%" />
<col width="32%" />
</colgroup>
<thead>
<tr class="header">
<th>Distribution</th>
<th>Name</th>
<th>FIMS wrapper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Normal</td>
<td><a href="http://kaskr.github.io/adcomp/dnorm_8hpp.html">dnorm</a></td>
<td><a href="https://github.com/NOAA-FIMS/FIMS/blob/80eed3821f501226052a7b01f278b19332d9dc69/inst/include/distributions/functors/tmb_distributions.hpp#L22">FIMS code</a></td>
</tr>
<tr class="even">
<td>Multinomial</td>
<td><a href="http://kaskr.github.io/adcomp/group__R__style__distribution.html#gafd0ae6b53840267138bb9250115fbe8b">dmultinom</a></td>
<td><a href="https://github.com/NOAA-FIMS/FIMS/blob/80eed3821f501226052a7b01f278b19332d9dc69/inst/include/distributions/functors/tmb_distributions.hpp#LL47C22-L48C1">FIMS code</a></td>
</tr>
<tr class="odd">
<td>Lognormal</td>
<td><a href="http://kaskr.github.io/adcomp/dnorm_8hpp.html">uses dnorm</a></td>
<td><a href="https://github.com/NOAA-FIMS/FIMS/blob/80eed3821f501226052a7b01f278b19332d9dc69/inst/include/distributions/functors/tmb_distributions.hpp#L76">FIMS code</a></td>
</tr>
</tbody>
</table>
<div id="normal-distribution" class="section level4 hasAnchor" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Normal Distribution<a href="m1-model-specification.html#normal-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><span class="math display">\[f(x) = \frac{1}{\sigma\sqrt{2\pi}}\mathrm{exp}\Bigg(-\frac{(x-\mu)^2}{2\sigma^2} \Bigg),\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the mean of the distribution and <span class="math inline">\(\sigma^2\)</span> is the variance.</p>
</div>
<div id="multinomial-distribution" class="section level4 hasAnchor" number="4.1.2.2">
<h4><span class="header-section-number">4.1.2.2</span> Multinomial Distribution<a href="m1-model-specification.html#multinomial-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For <span class="math inline">\(k\)</span> categories and sample size, <span class="math inline">\(n\)</span>,</p>
<p><span class="math display">\[f(\underline{y}) = \frac{n!}{y_{1}!... y_{k}!}p^{y_{1}}_{1}...p^{y_{k}}_{k},\]</span></p>
<p>where <span class="math inline">\(\sum^{k}_{i=1}y_{i} = n\)</span>, <span class="math inline">\(p_{i} &gt; 0\)</span>, and <span class="math inline">\(\sum^{k}_{i=1}p_{i} = 1\)</span>.</p>
<p>The mean and variance of <span class="math inline">\(y_{i}\)</span> are respectively:</p>
<p><span class="math inline">\(\mu_{i} = np_{i}\)</span>,</p>
<p><span class="math inline">\(\sigma^{2}_{i} = np_{i}(1-p_{i})\)</span></p>
</div>
<div id="lognormal-distribution" class="section level4 hasAnchor" number="4.1.2.3">
<h4><span class="header-section-number">4.1.2.3</span> Lognormal Distribution<a href="m1-model-specification.html#lognormal-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><span class="math display">\[f(x) = \frac{1.0}{ x\sigma\sqrt{2\pi} }\mathrm{exp}\Bigg(-\frac{(\mathrm{ln}(x) - \mu)^{2}}{2\sigma^{2}}\Bigg),\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the mean of the distribution of <span class="math inline">\(\mathrm{ln(x)}\)</span> and <span class="math inline">\(\sigma^2\)</span> is the variance of <span class="math inline">\(\mathrm{ln}(x)\)</span>.</p>
</div>
</div>
</div>
<div id="beverton-holt-recruitment-function" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Beverton-Holt recruitment function<a href="m1-model-specification.html#beverton-holt-recruitment-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For parity with existing stock assessment models, the first recruitment
option in FIMS is the steepness parameterization of the Beverton-Holt model (Beverton and Holt, 1957),</p>
<p><span class="math display">\[R_t(S_{t-1})  =\frac{0.8R_0hS_{t-1}}{0.2R_0\phi_0(1-h) + S_{t-1}(h-0.2)}\]</span>
where <span class="math inline">\(R_t\)</span> and <span class="math inline">\(S_t\)</span> are mean recruitment and spawning biomass at time
<span class="math inline">\(t\)</span>, <span class="math inline">\(h\)</span> is steepness, and <span class="math inline">\(\phi_0\)</span> is the unfished
spawning biomass per recruit. The initial FIMS model implements a
static spawning biomass-per-recruit function, with the ability to
overload the method in the future to allow for time-variation in
spawning biomass per recruit that results from variation in life-history
characteristics (e.g., natural mortality, maturity, or weight-at-age).
Recruitment deviations (<span class="math inline">\(r_t\)</span>) are assumed to be
normally distributed in log space with standard deviation <span class="math inline">\(\sigma_R\)</span>,
<span class="math display">\[r_t \sim N(0,\sigma_R^2)\]</span></p>
<p>Because <span class="math inline">\(r_t\)</span> are applied as multiplicative, lognormal deviations,
predictions of realized recruitment include a term for bias correction (<span class="math inline">\(\sigma^2_R/2\)</span>). However,
true <span class="math inline">\(r_t\)</span> values are not known, but rather estimated (<span class="math inline">\(\hat{r}_t\)</span>),
and thus the bias correction applies an
adjustment factor, <span class="math inline">\(b_t=\frac{E[SD(\hat{r}_{t})]^2}{\sigma_R^2}\)</span> (Methot and
Taylor, 2011). The adjusted bias correction, mean recruitment, and recruitment deviations are
then used to compute realized recruitment (<span class="math inline">\(R^*_t\)</span>),
<span class="math display">\[R^*_t=R_t\cdot\mathrm{exp}\Bigg(\hat{r}_{t}-b_t\frac{\sigma_R^2}{2}\Bigg)\]</span>
The recruitment function should take as input the values of <span class="math inline">\(S_t\)</span>,
<span class="math inline">\(h\)</span>, <span class="math inline">\(R_0\)</span>, <span class="math inline">\(\phi_0\)</span>, <span class="math inline">\(\sigma_R\)</span>, and <span class="math inline">\(\hat{r}_{t}\)</span>, and return mean-unbiased (<span class="math inline">\(R_t\)</span>) and
realized (<span class="math inline">\(R^*_t\)</span>) recruitment.</p>
</div>
<div id="logistic-function-with-extensions" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Logistic function with extensions<a href="m1-model-specification.html#logistic-function-with-extensions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="math display">\[y_i=\frac{1}{1+\mathrm{exp}(-s \cdot(x_i-\nu))}\]</span></p>
<p>Where <span class="math inline">\(y_i\)</span> is the quantity of interest (proportion mature, selected,
etc.), <span class="math inline">\(x_i\)</span> is the index (can be age or size or any other quantity),
<span class="math inline">\(\nu\)</span> is the median (inflection point), and <span class="math inline">\(s\)</span> is the slope parameter
from an alternative parameterization. Logistic functions for maturity
and selectivity should inherit and extend upon the base logistic
function implementation.</p>
<p>The parameterization for the double logistic curve is specified as</p>
<p><span class="math display">\[y_i=\frac{1.0}{ 1.0 + \mathrm{exp}(-1.0 \cdot s_1(x_i - \nu_1))} \left(1-\frac{1.0}{ 1.0 + \mathrm{exp}(-1.0 \cdot s_2 (x_i - \nu_2))}  \right)\]</span>
Where <span class="math inline">\(s_1\)</span> and and <span class="math inline">\(\nu_1\)</span> are the slope and median (50%) parameters for the ascending limb of the curve, and <span class="math inline">\(s_2\)</span> and and <span class="math inline">\(\nu_2\)</span> are the slope and median parameters for the descending limb of the curve. This is currently only implemented for the selectivity module.</p>
</div>
<div id="catch-and-fishing-mortality" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Catch and fishing mortality<a href="m1-model-specification.html#catch-and-fishing-mortality" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Baranov catch equation relates catch to instantaneous fishing and
natural mortality.</p>
<p><span class="math display">\[ C_{f,a,t}=\frac{F_{f,a,t}}{F_{f,a,t}+M}\Bigg[1-\mathrm{exp}(-F_{f,a,t}-M)\Bigg]N_{a,t}\]</span></p>
<p>Where <span class="math inline">\(C_{f,a,t}\)</span> is the catch at age <span class="math inline">\(a\)</span> at time <span class="math inline">\(t\)</span> for fleet <span class="math inline">\(f\)</span>, <span class="math inline">\(F_t\)</span>
is instantaneous fishing mortality, <span class="math inline">\(M\)</span> is assumed constant over ages
and time in the minimum viable assessment model, <span class="math inline">\(N_{a,t}\)</span> is the number
of age <span class="math inline">\(a\)</span> fish at time <span class="math inline">\(t\)</span>.</p>
<p><span class="math display">\[F_{f,a,t}=\sum_{a=0}^A s_{f,a}F_t\]</span></p>
<p><span class="math inline">\(s_{f,a}\)</span> is selectivity at age <span class="math inline">\(a\)</span> for fleet <span class="math inline">\(f\)</span>. Selectivity-at-age is
constant over time.</p>
<p>Catch is in metric tons and survey is in number, so calculating catch
weight (<span class="math inline">\(CW_t\)</span>) is done as follows:
<span class="math display">\[ CW_t=\sum_{a=0}^A C_{a,t}w_a \]</span></p>
<p>Survey numbers are calculated as follows</p>
<p><span class="math display">\[I_t=q_t\sum_{a=0}^AN_{a,t}\]</span>
Where <span class="math inline">\(I_t\)</span> is the survey index and <span class="math inline">\(q_t\)</span> is survey catchability at time
<span class="math inline">\(t\)</span>.</p>
</div>
<div id="modeling-loops" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Modeling loops<a href="m1-model-specification.html#modeling-loops" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This tier associates the expected values for each population section
associated with a data source to that data source using a likelihood
function. These likelihood functions are then combined into an objective
function that is passed to TMB.</p>
<p>The population loop is initialized at a user-specified age, time
increment, and seasonal structure, rather than assuming ages, years, or
seasons follow any pre-defined structure. Population categories will be
described flexibly, such that subpopulations such as unique sexes,
stocks, species, or areas can be handled identically to reduce
duplication. Each subpopulation will have a unique set of attributes
assigned to it, such that each subpopulation can share or have a
different functional process (e.g., recruitment function, size-at-age)
than a different category.</p>
<p>Spawning time and recruitment time are user-specified and can occur more
than once per year. For the purposes of replicating model comparison
project outputs, in milestone 1, all processes including spawning and
recruitment occur January 1, but these should be specified via the
<code>spawn_time</code> and <code>recruit_time</code> inputs into FIMS to allow for future
flexibility. Spawning and recruitment timing can be input as a scalar or
vector to account for multiple options.</p>
<p>Within the population loop, matrices denoting population properties at
different partitions (age, season, sex) are translated into a single,
dimension-folded index. A lookup table is computed at model start so
that the dimension-folded index can be mapped to its corresponding
population partition or time partition (e.g., population(sex, area, age,
species, time, …)) so the programmer can understand what is happening.
The model steps through each specified timestep to match the data to
expected values, and population processes occur in the closest specified
timestep to the user-input process timing (e.g., recruitment) across a
small timestep that is a predefined constant.</p>
</div>
<div id="expected-numbers-and-quantities" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Expected numbers and quantities<a href="m1-model-specification.html#expected-numbers-and-quantities" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The expected values are calculated as follows in the population.hpp
file:
<span class="math display">\[ B_t=\sum_{a=0}^AN_{a,t}w_a\]</span>
where <span class="math inline">\(B_t\)</span> is total biomass in time <span class="math inline">\(t\)</span>, <span class="math inline">\(N\)</span> is total numbers, <span class="math inline">\(w_a\)</span> is
weight-at-age <span class="math inline">\(a\)</span> in kilograms.</p>
<p><span class="math display">\[N_t=\sum_{a=0}^AN_{a,t}\]</span>
where <span class="math inline">\(N_at\)</span> is the total number of fish at age <span class="math inline">\(a\)</span> in time <span class="math inline">\(t\)</span>.</p>
<p><span class="math display">\[UnfishedNAA_{t,0} = R0_{t}\]</span></p>
<p>Annual unfished numbers at age and unfished spawning biomass are tracked
in the model assuming annual recruitment at rzero and only natural mortality.
This provides a dynamic reference point that accounts for time varying rzero
and M. This does not currently include recruitment deviations.
<span class="math display">\[UnfishedNAA_{t,0} = R0_{t}\]</span>
<span class="math display">\[UnfishedNAA_{t,a} = UnfishedNAA_{t-1,a-1}exp(-M_{t-1,a-1})\]</span>
for all t&gt;0 and numbers at age at the start of the first year are model parameter
inputs.</p>
<p><span class="math display">\[ UnfishedSSB_t=\sum_{a=0}^AUnfishedNAA_{a,t}w_aFracFemale_aFracMature_a\]</span>
All spawning stock biomass values are current calculated at January 1 each year.
This will be updated in future milestones.</p>
</div>
<div id="initial-values" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Initial values<a href="m1-model-specification.html#initial-values" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The initial equilibrium recruitment (<span class="math inline">\(R_{eq}\)</span>) is calculated as follows:</p>
<p><span class="math display">\[R_{eq} = \frac{R_{0}(4h\phi_{F} - (1-h)\phi_{0})}{(5h-1)\phi_{F}} \]</span>
where <span class="math inline">\(\phi_{F}\)</span> is the initial spawning biomass per recruitment given
the initial fishing mortality <span class="math inline">\(F\)</span>.</p>
<p>The initial population structure at the start of the first model year is
input as an estimated parameter vector of numbers at age. This allows maximum
flexibility for the model to estimate non-equilibrium starting conditions.
Future milestones could add an option to input a single F value used to
calculate an equilibrium starting structure.</p>
</div>
<div id="likelihood-calculations" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Likelihood calculations<a href="m1-model-specification.html#likelihood-calculations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Age composition likelihood links proportions at age from data to model
using a multinomial likelihood function. The multinomial and lognormal
distributions, including atomic functions are provided within <code>TMB</code>.</p>
<p>Survey index likelihood links estimated CPUE to input data CPUE in
biomass using a lognormal distribution. (model.hpp)</p>
<p>Catch index likelihood links estimated catch to input data catch in
biomass using a lognormal distribution. (model.hpp)</p>
<p>Age composition likelihoods link catch-at-age to expected catch-at-age
using a multinomial distribution.</p>
<p>Recruitment deviations control the difference between expected and realized recruitment,
and they follow a lognormal distribution. (recruitment_base.hpp)</p>
</div>
<div id="statistical-inference" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> Statistical Inference:<a href="m1-model-specification.html#statistical-inference" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TODO: Add description detailing the statistical inference used in M1</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fims-project-management-process.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="user-guide.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": null,
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/noaa-fims/collaborative_workflow/edit/main/03-model-specification.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/noaa-fims/collaborative_workflow/blob/main/03-model-specification.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
